<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Content & Marketing - Admin</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root{ --jh-radius: .85rem; }
    body{ font-family: Candara, "Segoe UI", Tahoma, Arial, sans-serif; }
    .app-shell{ min-height:100vh; }
    .sidebar-link.active{ font-weight:700; }
    .banner-preview{ height:120px; width:200px; object-fit:cover; border-radius: var(--jh-radius); border: 1px solid rgba(0,0,0,.08); }
    .banner-row{ border: 1px solid rgba(0,0,0,.08); border-radius: var(--jh-radius); padding: .9rem; }
    .banner-row + .banner-row{ margin-top: .75rem; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .small-muted{ font-size: .9rem; color: rgba(0,0,0,.55); }
    .btn-icon{ width: 2.25rem; }
    .w-200{ width: 200px; }
    @media (max-width: 576px){
      .banner-preview{ width: 140px; height: 96px; }
      .w-200{ width: 140px; }
    }
  </style>
</head>

<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom sticky-top">
    <div class="container-fluid">
      <button class="btn btn-outline-secondary d-lg-none me-2" data-bs-toggle="offcanvas" data-bs-target="#adminSidebar" aria-label="Open menu">‚ò∞</button>
      <a class="navbar-brand fw-bold" href="AdminDashboard.html">JUBA HOMEZ</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="AdminDashboard.html">ADMIN</a></li>
          <li class="nav-item"><a class="nav-link active fw-semibold" href="AdminContent.html">CONTENT</a></li>
        </ul>

        <div class="d-flex gap-2 align-items-center">
          <!-- If you don't have these pages yet, keep them as # so they don't 404 -->
          <a class="btn btn-outline-secondary position-relative" href="#" data-coming-soon="Messages">üí¨
            <span id="messagesBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
          </a>
          <a class="btn btn-outline-secondary position-relative" href="#" data-coming-soon="Notifications">üîî
            <span id="notifBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
          </a>

          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">üë§</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" data-coming-soon="Profile">Profile</a></li>
              <li><a class="dropdown-item" href="#" data-coming-soon="Settings">Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="login.html">Sign out</a></li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </nav>

  <!-- SHELL -->
  <div class="container-fluid app-shell">
    <div class="row">

      <!-- SIDEBAR -->
      <aside class="offcanvas-lg offcanvas-start bg-white border-end col-lg-3 col-xl-2 p-0" tabindex="-1" id="adminSidebar">
        <div class="offcanvas-header border-bottom">
          <h5 class="offcanvas-title">Admin Menu</h5>
          <button class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#adminSidebar" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body p-0">
          <div class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action sidebar-link" href="AdminDashboard.html">Overview</a>
            <a class="list-group-item list-group-item-action sidebar-link" href="AdminContent.html">Content</a>
            <a class="list-group-item list-group-item-action sidebar-link" href="AdminAnalytic.html">Analytics</a>
            <a class="list-group-item list-group-item-action sidebar-link" href="AdminDashboard.html#system">System</a>
          </div>
          <div class="p-3 border-top small text-muted">&copy; 2026 JUBA HOMEZ</div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="col-lg-9 col-xl-10 px-0">
        <div class="p-3 p-md-4">

          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
            <div>
              <h1 class="h3 mb-1">Content & Marketing</h1>
              <p class="text-muted mb-0">Manage homepage banners and featured sections.</p>
            </div>
            <div class="d-flex gap-2 flex-wrap">
              <button id="previewSiteBtn" class="btn btn-outline-secondary" type="button">Preview Site</button>
              <button id="addBannerBtn" class="btn btn-primary" type="button">+ Add Banner</button>
            </div>
          </div>

          <div class="row g-3">
            <!-- BANNERS -->
            <div class="col-12 col-xl-7">
              <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
                  <span>Homepage Banners</span>
                  <div class="d-flex gap-2">
                    <button id="seedDemoBtn" class="btn btn-sm btn-outline-secondary" type="button">Seed Demo</button>
                    <button id="resetBannersBtn" class="btn btn-sm btn-outline-danger" type="button">Reset</button>
                  </div>
                </div>
                <div class="card-body">

                  <div class="alert alert-info py-2 mb-3 small">
                    <strong>Demo mode:</strong> banners save in your browser using <span class="mono">localStorage</span>. When you add backend later, replace the save/load functions.
                  </div>

                  <div id="bannersList"></div>

                  <div id="bannersEmpty" class="text-center py-4 d-none">
                    <div class="h5 mb-1">No banners yet</div>
                    <div class="text-muted mb-3">Click <strong>+ Add Banner</strong> to create your first homepage banner.</div>
                    <button class="btn btn-primary" type="button" id="emptyAddBtn">+ Add Banner</button>
                  </div>

                  <div class="text-muted small mt-3">
                    Connect to: <code>GET /api/admin/content/banners</code> &nbsp;|&nbsp; <code>POST /api/admin/content/banners</code>
                  </div>
                </div>
              </div>
            </div>

            <!-- FEATURED SETTINGS -->
            <div class="col-12 col-xl-5">
              <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold">Featured Settings</div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Featured duration (days)</label>
                    <input id="featuredDuration" class="form-control" type="number" min="1" value="7">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Featured price ($)</label>
                    <input id="featuredPrice" class="form-control" type="number" min="0" value="50">
                  </div>

                  <div class="d-grid">
                    <button id="saveFeaturedBtn" class="btn btn-primary" type="button">Save</button>
                  </div>

                  <div class="mt-3 text-muted small">
                    Connect to: <code>PATCH /api/admin/settings</code>
                  </div>
                </div>
              </div>

              <div class="card shadow-sm mt-3">
                <div class="card-header bg-white fw-semibold">Tips</div>
                <div class="card-body small-muted">
                  <ul class="mb-0">
                    <li>Keep banner images light (under 300KB) for fast homepage loading.</li>
                    <li>Use a clear CTA like ‚ÄúBrowse Rentals‚Äù or ‚ÄúContact Broker‚Äù.</li>
                    <li>You can schedule banners using Start/End dates.</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <footer class="border-top py-3 mt-4">
            <div class="small text-muted d-flex justify-content-between flex-wrap gap-2">
              <span>&copy; 2026 JUBA HOMEZ</span>
              <span><a class="text-decoration-none" href="AdminDashboard.html">Back to dashboard</a></span>
            </div>
          </footer>

        </div>
      </main>
    </div>
  </div>

  <!-- BANNER MODAL -->
  <div class="modal fade" id="bannerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form id="bannerForm">
          <div class="modal-header">
            <h5 class="modal-title" id="bannerModalTitle">Add Banner</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <input type="hidden" id="bannerId">

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Banner Name (optional)</label>
                <input id="bannerName" class="form-control" type="text" placeholder="Banner #1">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Status</label>
                <select id="bannerStatus" class="form-select">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label">Headline <span class="text-danger">*</span></label>
                <input id="bannerHeadline" class="form-control" type="text" required placeholder="Find your next home in Juba">
              </div>

              <div class="col-12">
                <label class="form-label">Subheadline (optional)</label>
                <input id="bannerSubheadline" class="form-control" type="text" placeholder="Verified listings and trusted brokers.">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">CTA Text <span class="text-danger">*</span></label>
                <input id="bannerCtaText" class="form-control" type="text" required placeholder="Browse Listings">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">CTA Link (URL/path)</label>
                <input id="bannerCtaUrl" class="form-control" type="text" placeholder="../public/Property_Rent.html">
                <div class="form-text">Can be a relative path or full URL.</div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Image URL</label>
                <input id="bannerImageUrl" class="form-control" type="url" placeholder="https://example.com/banner.jpg">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Or Upload Image (small)</label>
                <input id="bannerImageFile" class="form-control" type="file" accept="image/*">
                <div class="form-text">For demo only. Large files may exceed localStorage limits.</div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Start Date (optional)</label>
                <input id="bannerStart" class="form-control" type="date">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">End Date (optional)</label>
                <input id="bannerEnd" class="form-control" type="date">
              </div>

              <div class="col-12">
                <div class="border rounded-3 p-2 d-flex gap-3 align-items-center">
                  <img id="bannerLivePreview" class="banner-preview w-200" src="https://picsum.photos/seed/jh_preview/800/300" alt="preview">
                  <div class="flex-grow-1">
                    <div class="fw-semibold" id="liveTitle">Preview</div>
                    <div class="small text-muted" id="liveHeadline">Headline will appear here‚Ä¶</div>
                    <div class="small text-muted" id="liveCta">CTA will appear here‚Ä¶</div>
                    <div class="small text-muted" id="liveSchedule">Schedule: ‚Äî</div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="saveBannerBtn">Save Banner</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="appToast" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastMsg">Saved</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // -----------------------------
    // DEMO BADGES (same idea as your existing file)
    // -----------------------------
    const demo = { notifications: 3, messages: 1 };

    function setBadge(id, count){
      const el = document.getElementById(id);
      if(!el) return;
      el.textContent = count;
      el.classList.toggle("d-none", !count || count <= 0);
    }
    setBadge("notifBadge", demo.notifications);
    setBadge("messagesBadge", demo.messages);

    // Prevent broken links (coming soon)
    document.addEventListener("click", (e) => {
      const a = e.target.closest("[data-coming-soon]");
      if(!a) return;
      e.preventDefault();
      toast(a.getAttribute("data-coming-soon") + " (coming soon)");
    });

    // Highlight active sidebar link
    (function highlightActiveLink(){
      const current = (location.pathname.split("/").pop() || "admin-content.html").toLowerCase();
      document.querySelectorAll(".sidebar-link").forEach(a=>{
        const href = (a.getAttribute("href") || "").toLowerCase();
        if(href === current) a.classList.add("active");
      });
    })();

    // -----------------------------
    // LOCAL STORAGE KEYS
    // -----------------------------
    const LS_BANNERS  = "jh_admin_banners_v1";
    const LS_FEATURED = "jh_admin_featured_settings_v1";

    // -----------------------------
    // TOAST
    // -----------------------------
    const toastEl = document.getElementById("appToast");
    const toastMsg = document.getElementById("toastMsg");
    const toastObj = new bootstrap.Toast(toastEl, { delay: 2200 });

    function toast(msg){
      toastMsg.textContent = msg;
      toastObj.show();
    }

    // -----------------------------
    // BANNERS: LOAD/SAVE
    // -----------------------------
    function uid(){
      return "bnr_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
    }

    function loadBanners(){
      try{
        const raw = localStorage.getItem(LS_BANNERS);
        if(!raw) return [];
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      }catch(err){
        return [];
      }
    }

    function saveBanners(list){
      localStorage.setItem(LS_BANNERS, JSON.stringify(list));
    }

    function seedDefaultIfEmpty(){
      const existing = loadBanners();
      if(existing.length) return;

      const sample = [{
        id: uid(),
        name: "Banner #1",
        headline: "Find your next home in Juba",
        subheadline: "",
        ctaText: "Browse Listings",
        ctaUrl: "../public/Property_Rent.html",
        imageUrl: "https://picsum.photos/seed/jubahomezBanner/800/300",
        status: "active",
        start: "",
        end: "",
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      }];

      saveBanners(sample);
    }

    // -----------------------------
    // RENDER
    // -----------------------------
    const bannersListEl = document.getElementById("bannersList");
    const bannersEmptyEl = document.getElementById("bannersEmpty");

    function scheduleText(b){
      if(!b.start && !b.end) return "Schedule: ‚Äî";
      if(b.start && !b.end) return "Schedule: starts " + b.start;
      if(!b.start && b.end) return "Schedule: until " + b.end;
      return "Schedule: " + b.start + " ‚Üí " + b.end;
    }

    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    function renderBanners(){
      const banners = loadBanners();

      bannersEmptyEl.classList.toggle("d-none", banners.length > 0);
      bannersListEl.innerHTML = "";

      if(!banners.length) return;

      banners.forEach((b, index) => {
        const isActive = (b.status === "active");
        const badge = isActive
          ? `<span class="badge text-bg-success">Active</span>`
          : `<span class="badge text-bg-secondary">Inactive</span>`;

        const html = `
          <div class="banner-row" data-id="${esc(b.id)}">
            <div class="d-flex gap-3 align-items-start">
              <img class="banner-preview" src="${esc(b.imageUrl || "https://picsum.photos/seed/jh_fallback/800/300")}" alt="banner">
              <div class="flex-grow-1">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <div class="fw-semibold">${esc(b.name || ("Banner #" + (index+1)))}</div>
                  ${badge}
                </div>

                <div class="small text-muted mt-1">Headline: ‚Äú${esc(b.headline)}‚Äù</div>
                <div class="small text-muted">CTA: ‚Äú${esc(b.ctaText)}‚Äù <span class="text-muted">‚Üí</span> <span class="mono">${esc(b.ctaUrl || "‚Äî")}</span></div>
                ${b.subheadline ? `<div class="small text-muted">Sub: ‚Äú${esc(b.subheadline)}‚Äù</div>` : ""}
                <div class="small text-muted">${esc(scheduleText(b))}</div>

                <div class="d-flex gap-2 flex-wrap mt-2">
                  <button class="btn btn-sm btn-outline-primary" type="button" data-action="edit">Edit</button>
                  <button class="btn btn-sm btn-outline-secondary" type="button" data-action="toggle">${isActive ? "Disable" : "Enable"}</button>
                  <button class="btn btn-sm btn-outline-danger" type="button" data-action="delete">Delete</button>

                  <div class="ms-auto d-flex gap-2">
                    <button class="btn btn-sm btn-outline-secondary btn-icon" type="button" title="Move up" data-action="up" ${index===0?"disabled":""}>‚Üë</button>
                    <button class="btn btn-sm btn-outline-secondary btn-icon" type="button" title="Move down" data-action="down" ${index===banners.length-1?"disabled":""}>‚Üì</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        bannersListEl.insertAdjacentHTML("beforeend", html);
      });
    }

    // Event delegation for banner actions
    bannersListEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action]");
      if(!btn) return;

      const row = e.target.closest(".banner-row");
      if(!row) return;
      const id = row.getAttribute("data-id");
      const action = btn.getAttribute("data-action");

      const banners = loadBanners();
      const idx = banners.findIndex(x => x.id === id);
      if(idx < 0) return;

      if(action === "edit"){
        openEditModal(banners[idx]);
        return;
      }

      if(action === "toggle"){
        banners[idx].status = (banners[idx].status === "active") ? "inactive" : "active";
        banners[idx].updatedAt = new Date().toISOString();
        saveBanners(banners);
        renderBanners();
        toast("Banner updated");
        return;
      }

      if(action === "delete"){
        const ok = confirm("Delete this banner? This cannot be undone.");
        if(!ok) return;
        banners.splice(idx, 1);
        saveBanners(banners);
        renderBanners();
        toast("Banner deleted");
        return;
      }

      if(action === "up" && idx > 0){
        const tmp = banners[idx-1];
        banners[idx-1] = banners[idx];
        banners[idx] = tmp;
        saveBanners(banners);
        renderBanners();
        toast("Moved up");
        return;
      }

      if(action === "down" && idx < banners.length - 1){
        const tmp = banners[idx+1];
        banners[idx+1] = banners[idx];
        banners[idx] = tmp;
        saveBanners(banners);
        renderBanners();
        toast("Moved down");
        return;
      }
    });

    // -----------------------------
    // MODAL: ADD / EDIT
    // -----------------------------
    const bannerModalEl = document.getElementById("bannerModal");
    const bannerModal = new bootstrap.Modal(bannerModalEl);

    const bannerForm = document.getElementById("bannerForm");
    const bannerModalTitle = document.getElementById("bannerModalTitle");

    const bannerId = document.getElementById("bannerId");
    const bannerName = document.getElementById("bannerName");
    const bannerStatus = document.getElementById("bannerStatus");
    const bannerHeadline = document.getElementById("bannerHeadline");
    const bannerSubheadline = document.getElementById("bannerSubheadline");
    const bannerCtaText = document.getElementById("bannerCtaText");
    const bannerCtaUrl = document.getElementById("bannerCtaUrl");
    const bannerImageUrl = document.getElementById("bannerImageUrl");
    const bannerImageFile = document.getElementById("bannerImageFile");
    const bannerStart = document.getElementById("bannerStart");
    const bannerEnd = document.getElementById("bannerEnd");

    const bannerLivePreview = document.getElementById("bannerLivePreview");
    const liveTitle = document.getElementById("liveTitle");
    const liveHeadline = document.getElementById("liveHeadline");
    const liveCta = document.getElementById("liveCta");
    const liveSchedule = document.getElementById("liveSchedule");

    function resetModal(){
      bannerId.value = "";
      bannerName.value = "";
      bannerStatus.value = "active";
      bannerHeadline.value = "";
      bannerSubheadline.value = "";
      bannerCtaText.value = "";
      bannerCtaUrl.value = "";
      bannerImageUrl.value = "";
      bannerImageFile.value = "";
      bannerStart.value = "";
      bannerEnd.value = "";

      bannerLivePreview.src = "https://picsum.photos/seed/jh_preview/800/300";
      liveTitle.textContent = "Preview";
      liveHeadline.textContent = "Headline will appear here‚Ä¶";
      liveCta.textContent = "CTA will appear here‚Ä¶";
      liveSchedule.textContent = "Schedule: ‚Äî";
    }

    function openAddModal(){
      resetModal();
      bannerModalTitle.textContent = "Add Banner";
      bannerModal.show();
      bannerHeadline.focus();
    }

    function openEditModal(b){
      resetModal();
      bannerModalTitle.textContent = "Edit Banner";

      bannerId.value = b.id;
      bannerName.value = b.name || "";
      bannerStatus.value = b.status || "active";
      bannerHeadline.value = b.headline || "";
      bannerSubheadline.value = b.subheadline || "";
      bannerCtaText.value = b.ctaText || "";
      bannerCtaUrl.value = b.ctaUrl || "";
      bannerImageUrl.value = (b.imageUrl && !String(b.imageUrl).startsWith("data:")) ? b.imageUrl : "";
      bannerStart.value = b.start || "";
      bannerEnd.value = b.end || "";

      bannerLivePreview.src = b.imageUrl || "https://picsum.photos/seed/jh_preview/800/300";
      liveTitle.textContent = b.name || "Banner";
      liveHeadline.textContent = "Headline: " + (b.headline || "‚Äî");
      liveCta.textContent = "CTA: " + (b.ctaText || "‚Äî");
      liveSchedule.textContent = scheduleText(b);

      bannerModal.show();
      bannerHeadline.focus();
    }

    function updateLivePreview(){
      const tmp = {
        start: bannerStart.value,
        end: bannerEnd.value
      };
      liveTitle.textContent = bannerName.value || "Preview";
      liveHeadline.textContent = "Headline: " + (bannerHeadline.value || "‚Äî");
      liveCta.textContent = "CTA: " + (bannerCtaText.value || "‚Äî");
      liveSchedule.textContent = scheduleText(tmp);

      // Prefer image URL if provided
      if(bannerImageUrl.value){
        bannerLivePreview.src = bannerImageUrl.value;
      }
    }

    ["input","change"].forEach(evt => {
      bannerForm.addEventListener(evt, (e) => {
        if(e.target === bannerImageFile) return; // handled separately
        updateLivePreview();
      });
    });

    // Handle file upload (base64) for demo
    bannerImageFile.addEventListener("change", async () => {
      const file = bannerImageFile.files && bannerImageFile.files[0];
      if(!file) return;

      // soft limit
      const maxBytes = 350 * 1024; // 350KB
      if(file.size > maxBytes){
        toast("Image too large for demo. Use a smaller file or paste an Image URL.");
        bannerImageFile.value = "";
        return;
      }

      const dataUrl = await fileToDataURL(file);
      bannerImageUrl.value = ""; // clear URL if file chosen
      bannerLivePreview.src = dataUrl;
      toast("Image loaded (demo)");
      // store temp on form element
      bannerForm.dataset.uploadedImage = dataUrl;
    });

    function fileToDataURL(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    bannerForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const name = bannerName.value.trim();
      const headline = bannerHeadline.value.trim();
      const subheadline = bannerSubheadline.value.trim();
      const ctaText = bannerCtaText.value.trim();
      const ctaUrl = bannerCtaUrl.value.trim();
      const status = bannerStatus.value;
      const start = bannerStart.value;
      const end = bannerEnd.value;

      // Determine image
      let imageUrl = bannerImageUrl.value.trim();
      if(!imageUrl && bannerForm.dataset.uploadedImage){
        imageUrl = bannerForm.dataset.uploadedImage;
      }
      if(!imageUrl){
        imageUrl = "https://picsum.photos/seed/jh_" + Math.random().toString(16).slice(2) + "/800/300";
      }

      const list = loadBanners();
      const now = new Date().toISOString();
      const editingId = bannerId.value;

      if(editingId){
        const idx = list.findIndex(x => x.id === editingId);
        if(idx < 0){
          toast("Could not find banner to update");
          return;
        }
        list[idx] = {
          ...list[idx],
          name, headline, subheadline, ctaText, ctaUrl, imageUrl, status, start, end,
          updatedAt: now
        };
        saveBanners(list);
        renderBanners();
        bannerForm.dataset.uploadedImage = "";
        bannerModal.hide();
        toast("Banner updated");
      }else{
        const newBanner = {
          id: uid(),
          name: name || ("Banner #" + (list.length + 1)),
          headline,
          subheadline,
          ctaText,
          ctaUrl,
          imageUrl,
          status,
          start,
          end,
          createdAt: now,
          updatedAt: now
        };
        list.unshift(newBanner); // newest on top
        saveBanners(list);
        renderBanners();
        bannerForm.dataset.uploadedImage = "";
        bannerModal.hide();
        toast("Banner added");
      }
    });

    // -----------------------------
    // FEATURED SETTINGS (localStorage)
    // -----------------------------
    const featuredDuration = document.getElementById("featuredDuration");
    const featuredPrice = document.getElementById("featuredPrice");
    const saveFeaturedBtn = document.getElementById("saveFeaturedBtn");

    function loadFeatured(){
      try{
        const raw = localStorage.getItem(LS_FEATURED);
        if(!raw) return null;
        return JSON.parse(raw);
      }catch(err){
        return null;
      }
    }

    function saveFeatured(obj){
      localStorage.setItem(LS_FEATURED, JSON.stringify(obj));
    }

    function initFeatured(){
      const data = loadFeatured();
      if(!data) return;
      if(typeof data.duration === "number") featuredDuration.value = data.duration;
      if(typeof data.price === "number") featuredPrice.value = data.price;
    }

    saveFeaturedBtn.addEventListener("click", () => {
      const duration = Number(featuredDuration.value || 0);
      const price = Number(featuredPrice.value || 0);

      if(!Number.isFinite(duration) || duration <= 0){
        toast("Featured duration must be at least 1 day");
        featuredDuration.focus();
        return;
      }
      if(!Number.isFinite(price) || price < 0){
        toast("Featured price cannot be negative");
        featuredPrice.focus();
        return;
      }

      saveFeatured({ duration, price, updatedAt: new Date().toISOString() });
      toast("Featured settings saved");
    });

    // -----------------------------
    // TOP BUTTONS
    // -----------------------------
    document.getElementById("previewSiteBtn").addEventListener("click", () => {
      // If your admin folder is /admin and Index.html is at root, this is correct:
      window.open("../Index.html", "_blank");
    });

    document.getElementById("addBannerBtn").addEventListener("click", openAddModal);
    document.getElementById("emptyAddBtn").addEventListener("click", openAddModal);

    document.getElementById("seedDemoBtn").addEventListener("click", () => {
      const list = loadBanners();
      const now = new Date().toISOString();
      const demoSet = [
        {
          id: uid(),
          name: "Banner #1",
          headline: "Find your next home in Juba",
          subheadline: "Verified listings and trusted brokers.",
          ctaText: "Browse Rentals",
          ctaUrl: "../public/Property_Rent.html",
          imageUrl: "https://picsum.photos/seed/jh_banner1/800/300",
          status: "active",
          start: "",
          end: "",
          createdAt: now,
          updatedAt: now
        },
        {
          id: uid(),
          name: "Banner #2",
          headline: "List your property faster",
          subheadline: "Reach thousands of renters and buyers.",
          ctaText: "Add Listing",
          ctaUrl: "admin-listings.html",
          imageUrl: "https://picsum.photos/seed/jh_banner2/800/300",
          status: "inactive",
          start: "",
          end: "",
          createdAt: now,
          updatedAt: now
        }
      ];
      saveBanners(demoSet.concat(list));
      renderBanners();
      toast("Demo banners added");
    });

    document.getElementById("resetBannersBtn").addEventListener("click", () => {
      const ok = confirm("Reset banners? This will delete all saved demo banners in this browser.");
      if(!ok) return;
      localStorage.removeItem(LS_BANNERS);
      seedDefaultIfEmpty();
      renderBanners();
      toast("Banners reset");
    });

    // -----------------------------
    // INIT
    // -----------------------------
    seedDefaultIfEmpty();
    initFeatured();
    renderBanners();
  </script>

  <script src="assets/js/config.js"></script>
  <script src="assets/js/http.js"></script>
  <script src="assets/js/admin.js"></script>
  <script>Admin.wireComingSoon(); Admin.loadBadges(); Admin.loadPendingCounts();</script>
</body>
</html>
