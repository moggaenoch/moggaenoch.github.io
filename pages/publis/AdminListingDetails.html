<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Listing Detail - Admin</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body{ font-family: Candara, "Segoe UI", Tahoma, Arial, sans-serif; }
    .app-shell{min-height:100vh;}
    .sidebar-link.active{font-weight:700;}
    .gallery-img{height:320px; object-fit:cover;}
    .kv dt{color: #6c757d; font-weight: 600;}
    .thumb { width: 54px; height: 40px; object-fit: cover; border-radius: .5rem; border: 1px solid rgba(0,0,0,.08); }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .dropdown-toggle::after{ display:none !important; } /* remove dropdown arrow */
  </style>
</head>

<body class="bg-light">
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom sticky-top">
    <div class="container-fluid">
      <button class="btn btn-outline-secondary d-lg-none me-2" data-bs-toggle="offcanvas" data-bs-target="#adminSidebar" aria-label="Open menu">‚ò∞</button>
      <a class="navbar-brand fw-bold" href="AdminDashboard.html">JUBA HOMEZ</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="AdminDashboard.html">ADMIN</a></li>
          <li class="nav-item"><a class="nav-link" href="Adminlisting.html">LISTINGS</a></li>
          <li class="nav-item"><a class="nav-link active fw-semibold" href="AdminListingDetails.html">DETAIL</a></li>
        </ul>

        <div class="d-flex align-items-center gap-2">
          <!-- If you don‚Äôt have these pages yet, keep # and show coming soon -->
          <a class="btn btn-outline-secondary position-relative" href="#" data-coming-soon="Messages">üí¨
            <span id="messagesBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
          </a>
          <a class="btn btn-outline-secondary position-relative" href="#" data-coming-soon="Notifications">üîî
            <span id="notifBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
          </a>

          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">üë§</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" data-coming-soon="Profile">Profile</a></li>
              <li><a class="dropdown-item" href="#" data-coming-soon="Settings">Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="login.html">Sign out</a></li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </nav>

  <div class="container-fluid app-shell">
    <div class="row">

      <!-- SIDEBAR -->
      <aside class="offcanvas-lg offcanvas-start bg-white border-end col-lg-3 col-xl-2 p-0" tabindex="-1" id="adminSidebar">
        <div class="offcanvas-header border-bottom">
          <h5 class="offcanvas-title">Admin Menu</h5>
          <button class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#adminSidebar" aria-label="Close"></button>
        </div>

        <div class="offcanvas-body p-0">
          <div class="accordion accordion-flush" id="sidebarAccordion">
            <div class="accordion-item"><h2 class="accordion-header">
              <a class="accordion-button collapsed px-3 py-3 text-decoration-none sidebar-link" href="AdminDashboard.html">Overview</a>
            </h2></div>

            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button px-3 py-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseListings" aria-expanded="true">
                  Listings
                  <span class="ms-auto d-flex gap-2">
                    <span class="badge bg-warning-subtle text-warning" id="badgePending">0</span>
                    <span class="badge bg-success-subtle text-success" id="badgeActive">0</span>
                  </span>
                </button>
              </h2>

              <div id="collapseListings" class="accordion-collapse collapse show" data-bs-parent="#sidebarAccordion">
                <div class="accordion-body px-0 py-0">
                  <div class="list-group list-group-flush">
                    <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center sidebar-link"
                       href="AdminListingPending.html">
                      Pending Approval <span class="badge text-bg-warning rounded-pill" id="countPending">0</span>
                    </a>
                    <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center sidebar-link"
                       href="Adminlisting.html">
                      All Listings <span class="badge text-bg-secondary rounded-pill" id="countAll">0</span>
                    </a>
                    <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center sidebar-link"
                       href="AdminContent.html">
                      Featured/Content <span class="badge text-bg-primary rounded-pill" id="countFeatured">0</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item"><h2 class="accordion-header">
              <a class="accordion-button collapsed px-3 py-3 text-decoration-none sidebar-link" href="admin-users.html">Users & Roles</a>
            </h2></div>

            <div class="accordion-item"><h2 class="accordion-header">
              <a class="accordion-button collapsed px-3 py-3 text-decoration-none sidebar-link" href="AdminLeads.html">Leads</a>
            </h2></div>

            <div class="accordion-item"><h2 class="accordion-header">
              <a class="accordion-button collapsed px-3 py-3 text-decoration-none sidebar-link" href="AdminDashboard.html#system">System</a>
            </h2></div>
          </div>

          <div class="p-3 border-top small text-muted">&copy; 2026 JUBA HOMEZ</div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="col-lg-9 col-xl-10 px-0">
        <div class="p-3 p-md-4">

          <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
            <div>
              <h1 class="h3 mb-1">
                Listing Detail <span class="text-muted">#<span id="listingIdText">‚Äî</span></span>
              </h1>
              <p class="text-muted mb-0">Review details, approve/reject, feature, hide, edit, or delete.</p>
            </div>

            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-outline-primary" type="button" id="btnEdit">Edit</button>
              <button class="btn btn-outline-success" type="button" id="btnApprove">Approve</button>
              <button class="btn btn-outline-danger" type="button" id="btnReject">Reject</button>
              <button class="btn btn-outline-warning" type="button" id="btnHide">Hide</button>
              <button class="btn btn-outline-warning" type="button" id="btnUnhide">Unhide</button>
              <button class="btn btn-primary" type="button" id="btnFeature">Feature</button>
              <button class="btn btn-outline-danger" type="button" id="btnDelete">Delete</button>
            </div>
          </div>

          <div id="notFoundAlert" class="alert alert-warning d-none">
            Listing not found in demo storage. Go back to <a href="Adminlisting.html" class="alert-link">All Listings</a> and Seed Demo.
          </div>

          <div class="row g-3" id="detailShell">
            <div class="col-12 col-xxl-8">
              <div class="card shadow-sm mb-3">
                <div class="card-body p-0">
                  <div id="listingCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner" id="carouselInner"></div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#listingCarousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#listingCarousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  </div>
                </div>

                <div class="card-footer bg-white d-flex flex-wrap gap-2 justify-content-between align-items-center">
                  <div class="d-flex gap-2 flex-wrap">
                    <span class="badge" id="statusBadge">‚Äî</span>
                    <span class="badge" id="featuredBadge">‚Äî</span>
                    <span class="badge text-bg-secondary" id="typeBadge">Type: ‚Äî</span>
                  </div>
                  <a class="small text-decoration-none" href="Adminlisting.html">‚Üê Back to listings</a>
                </div>
              </div>

              <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold">Description</div>
                <div class="card-body">
                  <h5 class="mb-2" id="listingTitle">‚Äî</h5>
                  <p class="text-muted mb-0" id="listingDesc">
                    Demo description: replace with your real data later.
                  </p>
                </div>
              </div>
            </div>

            <div class="col-12 col-xxl-4">
              <div class="card shadow-sm mb-3">
                <div class="card-header bg-white fw-semibold">Key Details</div>
                <div class="card-body">
                  <dl class="row mb-0 kv">
                    <dt class="col-5">Price</dt><dd class="col-7" id="listingPrice">‚Äî</dd>
                    <dt class="col-5">Location</dt><dd class="col-7" id="listingLocation">‚Äî</dd>
                    <dt class="col-5">Type</dt><dd class="col-7" id="listingType">‚Äî</dd>
                    <dt class="col-5">Status</dt><dd class="col-7" id="listingStatus">‚Äî</dd>
                    <dt class="col-5">Featured</dt><dd class="col-7" id="listingFeatured">‚Äî</dd>
                    <dt class="col-5">Submitted</dt><dd class="col-7 mono" id="listingSubmitted">‚Äî</dd>
                  </dl>
                </div>
              </div>

              <div class="card shadow-sm mb-3">
                <div class="card-header bg-white fw-semibold">Owner / Broker</div>
                <div class="card-body">
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <div class="rounded-circle bg-secondary-subtle d-inline-flex align-items-center justify-content-center" style="width:42px;height:42px;">üë§</div>
                    <div>
                      <div class="fw-semibold" id="whoName">‚Äî</div>
                      <div class="small text-muted" id="whoRole">‚Äî</div>
                    </div>
                  </div>
                  <div class="d-grid gap-2">
                    <a class="btn btn-outline-secondary" href="#" data-coming-soon="View User">View User</a>
                    <button class="btn btn-outline-primary" type="button" data-coming-soon="Message User">Message User</button>
                  </div>
                </div>
              </div>

              <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold">Activity (demo)</div>
                <div class="card-body">
                  <div class="d-flex justify-content-between"><span>Views</span><span class="fw-semibold" id="viewsNum">‚Äî</span></div>
                  <div class="d-flex justify-content-between"><span>Saves</span><span class="fw-semibold" id="savesNum">‚Äî</span></div>
                  <div class="d-flex justify-content-between"><span>Leads</span><span class="fw-semibold" id="leadsNum">‚Äî</span></div>
                </div>
              </div>
            </div>
          </div>

          <footer class="border-top mt-4">
            <div class="container py-4 d-flex flex-column flex-md-row gap-2 align-items-center justify-content-between">
              <p class="mb-0 text-muted">&copy; 2026 JUBA HOMEZ. All rights reserved.</p>
              <div class="d-flex gap-3">
                <a class="text-decoration-none text-muted" href="../public/Contact.html">Contact</a>
                <a class="text-decoration-none text-muted" href="../public/Property_Rent.html">Rentals</a>
                <a class="text-decoration-none text-muted" href="../public/Property_Sale.html">Sales</a>
              </div>
            </div>
          </footer>

        </div>
      </main>

    </div>
  </div>

  <!-- EDIT MODAL (same fields as admin-listings.html demo) -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form id="editForm">
          <div class="modal-header">
            <h5 class="modal-title">Edit Listing</h5>
            <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <input type="hidden" id="editId" />
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Title <span class="text-danger">*</span></label>
                <input class="form-control" id="editTitle" required />
              </div>

              <div class="col-md-3">
                <label class="form-label">Type</label>
                <select class="form-select" id="editType">
                  <option>Apartment</option>
                  <option>House</option>
                  <option>Land</option>
                  <option>Commercial</option>
                </select>
              </div>

              <div class="col-md-3">
                <label class="form-label">Status</label>
                <select class="form-select" id="editStatus">
                  <option>Active</option>
                  <option>Pending</option>
                  <option>Hidden</option>
                  <option>Rejected</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Location</label>
                <input class="form-control" id="editLocation" />
              </div>

              <div class="col-md-3">
                <label class="form-label">Role</label>
                <select class="form-select" id="editRole">
                  <option>Broker</option>
                  <option>Owner</option>
                </select>
              </div>

              <div class="col-md-3">
                <label class="form-label">Owner/Broker Name</label>
                <input class="form-control" id="editOwner" />
              </div>

              <div class="col-md-3">
                <label class="form-label">Price</label>
                <input class="form-control" id="editPriceValue" type="number" min="0" />
              </div>

              <div class="col-md-3">
                <label class="form-label">Unit</label>
                <select class="form-select" id="editPriceUnit">
                  <option value="/ month">/ month</option>
                  <option value="/ week">/ week</option>
                  <option value="/ day">/ day</option>
                  <option value="">(Sale)</option>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Thumbnail URL</label>
                <input class="form-control" id="editThumb" placeholder="https://..." />
                <div class="form-text">Leave empty to auto-generate a demo thumbnail.</div>
              </div>

              <div class="col-md-6 d-flex align-items-end">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="editFeatured" />
                  <label class="form-check-label" for="editFeatured">Featured</label>
                </div>
              </div>

              <div class="col-12">
                <div class="border rounded-3 p-2 d-flex gap-3 align-items-center">
                  <img id="editThumbPreview" class="thumb" style="width:120px;height:90px;" src="https://picsum.photos/seed/jh_preview_listing/240/160" alt="preview">
                  <div class="small text-muted">Preview image</div>
                </div>
              </div>

            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="appToast" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastMsg">Saved</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // -----------------------------
    // COMING SOON GUARD
    // -----------------------------
    document.addEventListener("click", (e) => {
      const a = e.target.closest("[data-coming-soon]");
      if(!a) return;
      e.preventDefault();
      toast(a.getAttribute("data-coming-soon") + " (coming soon)");
    });

    // -----------------------------
    // TOAST
    // -----------------------------
    const toastEl = document.getElementById("appToast");
    const toastMsg = document.getElementById("toastMsg");
    const toastObj = new bootstrap.Toast(toastEl, { delay: 2200 });
    function toast(msg){ toastMsg.textContent = msg; toastObj.show(); }

    // Demo badges
    const demoBadges = { notifications: 3, messages: 1 };
    function setBadge(id, count){
      const el = document.getElementById(id);
      if(!el) return;
      el.textContent = count;
      el.classList.toggle("d-none", !count || count <= 0);
    }
    setBadge("notifBadge", demoBadges.notifications);
    setBadge("messagesBadge", demoBadges.messages);

    // Active sidebar highlight
    (function(){
      const current=(location.pathname.split("/").pop()||"admin-listing-detail.html").toLowerCase();
      document.querySelectorAll(".sidebar-link").forEach(a=>{
        const href=(a.getAttribute("href")||"").toLowerCase();
        if(href===current) a.classList.add("active");
      });
    })();

    // -----------------------------
    // LISTINGS STORAGE (must match admin-listings.html)
    // -----------------------------
    const LS_LISTINGS = "jh_admin_listings_v1";

    function loadListings(){
      try{
        const raw = localStorage.getItem(LS_LISTINGS);
        if(!raw) return [];
        const data = JSON.parse(raw);
        return Array.isArray(data) ? data : [];
      }catch(e){ return []; }
    }
    function saveListings(list){
      localStorage.setItem(LS_LISTINGS, JSON.stringify(list));
    }

    function updateSidebarCounts(){
      const all = loadListings();
      const pending = all.filter(x => x.status === "Pending").length;
      const active  = all.filter(x => x.status === "Active").length;
      const featured= all.filter(x => x.featured === true).length;

      document.getElementById("countPending").textContent = pending;
      document.getElementById("countAll").textContent = all.length;
      document.getElementById("countFeatured").textContent = featured;
      document.getElementById("badgePending").textContent = pending;
      document.getElementById("badgeActive").textContent = active;
    }

    function fmtPrice(x){
      const v = Number(x.priceValue || 0);
      const unit = x.priceUnit || "";
      const money = v.toLocaleString();
      return unit ? `$${money} ${unit}` : `$${money}`;
    }

    function statusBadgeInfo(st){
      if(st === "Active") return { cls:"text-bg-success", text:"Active" };
      if(st === "Pending") return { cls:"text-bg-warning", text:"Pending" };
      if(st === "Hidden") return { cls:"text-bg-secondary", text:"Hidden" };
      if(st === "Rejected") return { cls:"text-bg-danger", text:"Rejected" };
      return { cls:"text-bg-light text-dark", text: st || "‚Äî" };
    }

    function setActionButtonsState(listing){
      // Approve/Reject only for Pending
      const isPending = listing.status === "Pending";
      const isActive = listing.status === "Active";
      const isHidden = listing.status === "Hidden";

      document.getElementById("btnApprove").disabled = !isPending;
      document.getElementById("btnReject").disabled = !isPending;

      document.getElementById("btnHide").classList.toggle("d-none", !isActive);
      document.getElementById("btnUnhide").classList.toggle("d-none", !isHidden);

      // Feature only when Active
      document.getElementById("btnFeature").disabled = !isActive;
      document.getElementById("btnFeature").textContent = listing.featured ? "Unfeature" : "Feature";
    }

    // -----------------------------
    // READ ID FROM URL
    // -----------------------------
    const params = new URLSearchParams(location.search);
    const listingId = Number(params.get("id") || "701");
    document.getElementById("listingIdText").textContent = String(listingId);

    // -----------------------------
    // RENDER LISTING
    // -----------------------------
    function renderListing(){
      updateSidebarCounts();

      const list = loadListings();
      const listing = list.find(x => Number(x.id) === listingId);

      const shell = document.getElementById("detailShell");
      const notFound = document.getElementById("notFoundAlert");

      if(!listing){
        shell.classList.add("d-none");
        notFound.classList.remove("d-none");
        return;
      }

      shell.classList.remove("d-none");
      notFound.classList.add("d-none");

      // Carousel images
      const inner = document.getElementById("carouselInner");
      const baseThumb = listing.thumb || `https://picsum.photos/seed/jh_auto_${listingId}/1200/700`;
      const images = [
        baseThumb,
        `https://picsum.photos/seed/jh_detail_${listingId}_2/1200/700`,
        `https://picsum.photos/seed/jh_detail_${listingId}_3/1200/700`
      ];
      inner.innerHTML = images.map((src, idx) => `
        <div class="carousel-item ${idx===0?"active":""}">
          <img class="d-block w-100 gallery-img" src="${src}" alt="image ${idx+1}">
        </div>
      `).join("");

      // Badges + text
      const sb = statusBadgeInfo(listing.status);
      const statusBadge = document.getElementById("statusBadge");
      statusBadge.className = `badge ${sb.cls}`;
      statusBadge.textContent = sb.text;

      const featuredBadge = document.getElementById("featuredBadge");
      featuredBadge.className = `badge ${listing.featured ? "text-bg-primary" : "text-bg-secondary"}`;
      featuredBadge.textContent = `Featured: ${listing.featured ? "Yes" : "No"}`;

      document.getElementById("typeBadge").textContent = `Type: ${listing.type || "‚Äî"}`;

      document.getElementById("listingTitle").textContent = listing.title || "Untitled";
      document.getElementById("listingPrice").textContent = fmtPrice(listing);
      document.getElementById("listingLocation").textContent = listing.location || "‚Äî";
      document.getElementById("listingType").textContent = listing.type || "‚Äî";
      document.getElementById("listingStatus").textContent = listing.status || "‚Äî";
      document.getElementById("listingFeatured").textContent = listing.featured ? "Yes" : "No";

      const submitted = (listing.createdAt || listing.updatedAt || "").slice(0,10) || "‚Äî";
      document.getElementById("listingSubmitted").textContent = submitted;

      document.getElementById("whoName").textContent = listing.owner || "‚Äî";
      document.getElementById("whoRole").textContent = listing.role ? `${listing.role}` : "‚Äî";

      // Demo activity
      const seed = Number(listingId) || 1;
      document.getElementById("viewsNum").textContent = (900 + (seed % 400)).toLocaleString();
      document.getElementById("savesNum").textContent = String(40 + (seed % 90));
      document.getElementById("leadsNum").textContent = String(5 + (seed % 20));

      setActionButtonsState(listing);
    }

    // -----------------------------
    // UPDATE LISTING IN STORAGE
    // -----------------------------
    function updateListing(mutator){
      const list = loadListings();
      const idx = list.findIndex(x => Number(x.id) === listingId);
      if(idx < 0) return null;
      const item = list[idx];
      mutator(item);
      item.updatedAt = new Date().toISOString();
      // rule: non-active cannot be featured
      if(item.status !== "Active") item.featured = false;
      list[idx] = item;
      saveListings(list);
      return item;
    }

    // -----------------------------
    // ACTION BUTTONS
    // -----------------------------
    document.getElementById("btnApprove").addEventListener("click", () => {
      const updated = updateListing(x => { x.status = "Active"; });
      if(!updated) return;
      toast("Listing approved");
      renderListing();
    });

    document.getElementById("btnReject").addEventListener("click", () => {
      const ok = confirm("Reject this listing?");
      if(!ok) return;
      const updated = updateListing(x => { x.status = "Rejected"; x.featured = false; });
      if(!updated) return;
      toast("Listing rejected");
      renderListing();
    });

    document.getElementById("btnHide").addEventListener("click", () => {
      const updated = updateListing(x => { x.status = "Hidden"; x.featured = false; });
      if(!updated) return;
      toast("Listing hidden");
      renderListing();
    });

    document.getElementById("btnUnhide").addEventListener("click", () => {
      const updated = updateListing(x => { x.status = "Active"; });
      if(!updated) return;
      toast("Listing unhidden");
      renderListing();
    });

    document.getElementById("btnFeature").addEventListener("click", () => {
      const updated = updateListing(x => {
        if(x.status !== "Active") return;
        x.featured = !x.featured;
      });
      if(!updated) return;
      toast(updated.featured ? "Featured enabled" : "Featured removed");
      renderListing();
    });

    document.getElementById("btnDelete").addEventListener("click", () => {
      const ok = confirm("Delete this listing? This cannot be undone.");
      if(!ok) return;

      const list = loadListings();
      const idx = list.findIndex(x => Number(x.id) === listingId);
      if(idx < 0) return;
      list.splice(idx, 1);
      saveListings(list);

      toast("Listing deleted");
      setTimeout(() => location.href = "admin-listings.html", 600);
    });

    // -----------------------------
    // EDIT MODAL
    // -----------------------------
    const editModalEl = document.getElementById("editModal");
    const editModal = new bootstrap.Modal(editModalEl);

    const editForm = document.getElementById("editForm");
    const editId = document.getElementById("editId");
    const editTitle = document.getElementById("editTitle");
    const editType = document.getElementById("editType");
    const editStatus = document.getElementById("editStatus");
    const editLocation = document.getElementById("editLocation");
    const editRole = document.getElementById("editRole");
    const editOwner = document.getElementById("editOwner");
    const editPriceValue = document.getElementById("editPriceValue");
    const editPriceUnit = document.getElementById("editPriceUnit");
    const editThumb = document.getElementById("editThumb");
    const editFeatured = document.getElementById("editFeatured");
    const editThumbPreview = document.getElementById("editThumbPreview");

    function openEdit(){
      const list = loadListings();
      const listing = list.find(x => Number(x.id) === listingId);
      if(!listing){
        toast("Listing not found");
        return;
      }

      editId.value = listing.id;
      editTitle.value = listing.title || "";
      editType.value = listing.type || "Apartment";
      editStatus.value = listing.status || "Active";
      editLocation.value = listing.location || "";
      editRole.value = listing.role || "Broker";
      editOwner.value = listing.owner || "";
      editPriceValue.value = Number.isFinite(Number(listing.priceValue)) ? listing.priceValue : 0;
      editPriceUnit.value = listing.priceUnit ?? "/ month";
      editThumb.value = listing.thumb || "";
      editFeatured.checked = !!listing.featured;

      editThumbPreview.src = listing.thumb || `https://picsum.photos/seed/jh_auto_${listingId}/240/160`;
      editModal.show();
      editTitle.focus();
    }

    document.getElementById("btnEdit").addEventListener("click", openEdit);

    editThumb.addEventListener("input", () => {
      const v = editThumb.value.trim();
      if(v) editThumbPreview.src = v;
    });

    editForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const title = editTitle.value.trim();
      if(!title){
        toast("Title is required");
        editTitle.focus();
        return;
      }

      const updated = updateListing(x => {
        x.title = title;
        x.type = editType.value;
        x.status = editStatus.value;
        x.location = editLocation.value.trim();
        x.role = editRole.value;
        x.owner = editOwner.value.trim();
        x.priceValue = Number(editPriceValue.value || 0);
        x.priceUnit = editPriceUnit.value;

        const thumb = editThumb.value.trim();
        x.thumb = thumb || `https://picsum.photos/seed/jh_auto_${listingId}/240/160`;

        // feature only if Active
        x.featured = (x.status === "Active") ? !!editFeatured.checked : false;
      });

      if(!updated) return;
      editModal.hide();
      toast("Listing updated");
      renderListing();
    });

    // -----------------------------
    // INIT
    // -----------------------------
    renderListing();
  </script>

  <script src="assets/js/config.js"></script>
  <script src="assets/js/http.js"></script>
  <script src="assets/js/admin.js"></script>
  <script>Admin.wireComingSoon(); Admin.loadBadges(); Admin.loadPendingCounts();</script>

  <script src="assets/js/admin-pending.js"></script>
</body>
</html>
